<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×¨ ×”××ª×›×•× ×™× ×”××©×¤×—×ª×™</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <style> body { font-family: 'Varela Round', sans-serif; } </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // ×”-Config ×”××“×•×™×§ ×©×”×¢×ª×§×ª ×™×“× ×™×ª
        const firebaseConfig = {
          apiKey: "AIzaSyAO0ohZaZKbc1KD5paahk5V6r412pFe-38",
          authDomain: "atar-matconim.firebaseapp.com",
          projectId: "atar-matconim",
          storageBucket: "atar-matconim.firebasestorage.app",
          messagingSenderId: "533416888164",
          appId: "1:533416888164:web:04127c9ef7784c42ff9c71",
          measurementId: "G-GS2GVQKL8L"
        };

        // ××ª×—×•×œ Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const auth = firebase.auth();

        const { useState, useEffect } = React;

        const App = () => {
            const [recipes, setRecipes] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [newRecipe, setNewRecipe] = useState({ title: "", ingredients: "", author: "" });

            useEffect(() => {
                // ×”×ª×—×‘×¨×•×ª ×× ×•× ×™××™×ª (×›×‘×¨ ×”×¤×¢×œ×ª ×‘-Firebase!)
                auth.signInAnonymously()
                    .then(() => {
                        // ×—×™×‘×•×¨ ×œ××¡×“ ×”× ×ª×•× ×™× (×”×¤×¢×œ×ª ×‘-Firestore!)
                        return db.collection('family_recipes').onSnapshot(snap => {
                            const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            setRecipes(data.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)));
                            setLoading(false);
                        });
                    })
                    .catch(err => {
                        console.error("×©×’×™××ª ×—×™×‘×•×¨:", err);
                        setLoading(false);
                    });
            }, []);

            const handleAdd = async (e) => {
                e.preventDefault();
                try {
                    await db.collection('family_recipes').add({
                        ...newRecipe,
                        timestamp: Date.now(),
                        createdAt: new Date().toLocaleDateString('he-IL')
                    });
                    setIsAddModalOpen(false);
                    setNewRecipe({ title: "", ingredients: "", author: "" });
                } catch (err) {
                    alert("×©×’×™××” ×‘×©××™×¨×”: ×•×•×“× ×©×”×¤×¢×œ×ª 'Test Mode' ×‘-Rules ×©×œ ×”-Database");
                }
            };

            if (loading) return <div className="h-screen flex items-center justify-center font-bold text-orange-600">××ª×—×‘×¨ ×œ×¡×¤×¨ ×”××ª×›×•× ×™×...</div>;

            return (
                <div className="min-h-screen p-6 max-w-4xl mx-auto text-right" dir="rtl">
                    <header className="flex justify-between items-center mb-12">
                        <h1 className="text-4xl font-black text-orange-600">ğŸ“– ×¡×¤×¨ ×”××ª×›×•× ×™×</h1>
                        <button onClick={() => setIsAddModalOpen(true)} className="bg-orange-600 text-white px-6 py-3 rounded-2xl font-bold shadow-lg"> + ×”×•×¡×¤×ª ××ª×›×•×Ÿ </button>
                    </header>

                    <main className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {recipes.length === 0 ? (
                            <p className="col-span-full text-center text-slate-400 py-20 italic">×”×¡×¤×¨ ×¢×“×™×™×Ÿ ×¨×™×§. ×ª×”×™×• ×”×¨××©×•× ×™× ×œ×”×•×¡×™×£!</p>
                        ) : (
                            recipes.map(recipe => (
                                <div key={recipe.id} className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                                    <h3 className="text-2xl font-black mb-4">{recipe.title}</h3>
                                    <p className="text-slate-600 mb-6 whitespace-pre-wrap">{recipe.ingredients}</p>
                                    <div className="pt-4 border-t text-xs text-slate-400 font-bold flex justify-between">
                                        <span>ğŸ‘¨â€ğŸ³ {recipe.author || "×‘×Ÿ ××©×¤×—×”"}</span>
                                        <span>{recipe.createdAt}</span>
                                    </div>
                                </div>
                            ))
                        )}
                    </main>

                    {isAddModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-white w-full max-w-lg p-10 rounded-[3rem] shadow-2xl">
                                <h2 className="text-2xl font-black mb-6">××ª×›×•×Ÿ ×—×“×©</h2>
                                <form onSubmit={handleAdd} className="space-y-4">
                                    <input placeholder="×©× ×”×× ×”" className="w-full p-4 bg-slate-50 rounded-2xl outline-none border-2 focus:border-orange-500" value={newRecipe.title} onChange={e => setNewRecipe({...newRecipe, title: e.target.value})} required />
                                    <input placeholder="××™ ×”××‘×©×œ?" className="w-full p-4 bg-slate-50 rounded-2xl outline-none" value={newRecipe.author} onChange={e => setNewRecipe({...newRecipe, author: e.target.value})} />
                                    <textarea placeholder="××¦×¨×›×™× ×•×”×•×¨××•×ª..." className="w-full p-4 bg-slate-50 rounded-2xl outline-none h-40" value={newRecipe.ingredients} onChange={e => setNewRecipe({...newRecipe, ingredients: e.target.value})} required />
                                    <button type="submit" className="w-full py-4 bg-orange-600 text-white font-black rounded-2xl">×©××•×¨ ×‘×¡×¤×¨</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>