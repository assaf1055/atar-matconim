<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×¨ ×”××ª×›×•× ×™× ×”××©×¤×—×ª×™</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Varela Round', sans-serif; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // ×”-Config ×”×××™×ª×™ ×©×œ×š ××”×ª××•× ×” ×”××—×¨×•× ×”
        const firebaseConfig = {
          apiKey: "AIzaSyA0OohZaZKbc1KD5paahk5V6r412pFe-38",
          authDomain: "atar-matconim.firebaseapp.com",
          projectId: "atar-matconim",
          storageBucket: "atar-matconim.firebasestorage.app",
          messagingSenderId: "533416888164",
          appId: "1:533416888164:web:84127c9ef77b4c42ff9c71",
          measurementId: "G-GS2GVQKL8L"
        };

        // ××ª×—×•×œ Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const appId = 'recipe-family-shared';

        const { useState, useEffect } = React;

        const App = () => {
            const [authReady, setAuthReady] = useState(false);
            const [recipes, setRecipes] = useState([]);
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [newRecipe, setNewRecipe] = useState({ title: "", ingredients: "", author: "" });

            useEffect(() => {
                auth.signInAnonymously().then(() => setAuthReady(true));
                
                // ×—×™×‘×•×¨ ×œ××¡×“ ×”× ×ª×•× ×™× ×•×§×‘×œ×ª ××ª×›×•× ×™× ×‘×–××Ÿ ×××ª
                const unsubscribe = db.collection('family_recipes')
                    .onSnapshot(snap => {
                        const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setRecipes(data.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)));
                    });
                return () => unsubscribe();
            }, []);

            const handleAdd = async (e) => {
                e.preventDefault();
                await db.collection('family_recipes').add({
                    ...newRecipe,
                    timestamp: Date.now(),
                    createdAt: new Date().toLocaleDateString('he-IL')
                });
                setIsAddModalOpen(false);
                setNewRecipe({ title: "", ingredients: "", author: "" });
            };

            if (!authReady) return <div className="h-screen flex items-center justify-center font-bold">××ª×—×‘×¨ ×œ××¡×“ ×”× ×ª×•× ×™×...</div>;

            return (
                <div className="min-h-screen p-6">
                    <header className="max-w-4xl mx-auto flex justify-between items-center mb-12">
                        <h1 className="text-4xl font-black text-orange-600">ğŸ“– ×¡×¤×¨ ×”××ª×›×•× ×™×</h1>
                        <button onClick={() => setIsAddModalOpen(true)} className="bg-orange-600 text-white px-6 py-3 rounded-2xl font-bold shadow-lg hover:scale-105 transition-transform">
                            + ×”×•×¡×¤×ª ××ª×›×•×Ÿ
                        </button>
                    </header>

                    <main className="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                        {recipes.length === 0 ? (
                            <p className="col-span-full text-center text-slate-400 py-20 italic">×¢×“×™×™×Ÿ ××™×Ÿ ××ª×›×•× ×™×. ×ª×”×™×• ×”×¨××©×•× ×™× ×œ×”×•×¡×™×£!</p>
                        ) : (
                            recipes.map(recipe => (
                                <div key={recipe.id} className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
                                    <h3 className="text-2xl font-black mb-4 text-slate-800">{recipe.title}</h3>
                                    <div className="mb-6">
                                        <h4 className="text-orange-600 font-bold text-sm mb-2">××¦×¨×›×™×:</h4>
                                        <p className="text-slate-600 whitespace-pre-wrap">{recipe.ingredients}</p>
                                    </div>
                                    <div className="pt-4 border-t flex justify-between items-center text-xs text-slate-400 font-bold">
                                        <span>ğŸ‘¨â€ğŸ³ ×××ª: {recipe.author || "×‘×Ÿ ××©×¤×—×”"}</span>
                                        <span>{recipe.createdAt}</span>
                                    </div>
                                </div>
                            ))
                        )}
                    </main>

                    {isAddModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-white w-full max-w-lg p-10 rounded-[3rem] shadow-2xl">
                                <h2 className="text-3xl font-black mb-6 text-slate-800">×”×•×¡×¤×ª ××ª×›×•×Ÿ ×—×“×©</h2>
                                <form onSubmit={handleAdd} className="space-y-4">
                                    <input placeholder="×©× ×”×× ×” (×œ××©×œ: ×”×©× ×™×¦×œ ×©×œ ×××)" className="w-full p-4 bg-slate-50 rounded-2xl outline-none border-2 focus:border-orange-500 transition-colors" value={newRecipe.title} onChange={e => setNewRecipe({...newRecipe, title: e.target.value})} required />
                                    <input placeholder="××™ ×”××‘×©×œ?" className="w-full p-4 bg-slate-50 rounded-2xl outline-none" value={newRecipe.author} onChange={e => setNewRecipe({...newRecipe, author: e.target.value})} />
                                    <textarea placeholder="×¨×©×™××ª ××¦×¨×›×™× ×•×”×•×¨××•×ª..." className="w-full p-4 bg-slate-50 rounded-2xl outline-none h-40 resize-none" value={newRecipe.ingredients} onChange={e => setNewRecipe({...newRecipe, ingredients: e.target.value})} required />
                                    <div className="flex gap-3 pt-4">
                                        <button type="button" onClick={() => setIsAddModalOpen(false)} className="flex-1 py-4 bg-slate-100 text-slate-600 font-bold rounded-2xl">×‘×™×˜×•×œ</button>
                                        <button type="submit" className="flex-1 py-4 bg-orange-600 text-white font-black rounded-2xl shadow-xl hover:bg-orange-700 transition-colors">×©××•×¨ ×‘×¡×¤×¨</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>